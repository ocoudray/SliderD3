# jupyter-widget installation procedure

This process works smoothly more often than not.  
But if anything fails, it is not clear what to fix.  
So let us examine the details so you can manually correct things if necessary.

To be very practical, even reproducible in the same environment, let us consider the jupyter-widget-d3-slider example. (Code available in this [repo](TBD))

For a jupyter-widget to work in the notebook you must have done the following:
1. Build compiled javascript (`widget_d3_slider/static/`) from the javascript source code (`js/lib`)
1. Install the Python package, containing the folder static/
1. Put compiled javascript files in a system nbextension/ folder
1. Enable nbextension


Let us run these 2 steps manually.

## 1 - Build compiled javascript

Initially the juputer-widget folder contains the following folders and files:
+ `js/`: These are javascript and css **source code** files
+ `package.json`: This is a **npm configuration file**
+ `webpack.config.js`: **webpack config file**

The first step is to run `npm install` which will:
+ Download from the internet all the packages mentioned in the fields `dependencies` and `devDependencies` and store them in node_modules/. Beware that is usually thousands of files. It will also put a copy of these files in ~/.npm so that the next time you install a package it will first look there.
+ Run Webpack according to `webpack.config.js`. Webpack config files syntax is notoriously obscure. But essentially it will:
    + Compile the source files in js/ into compiled files in `widget_d3_slider/static`. These are self contained `.js` files and `.js.map` files
    + Compile the source files in `js/` into compiled files in `dist/`. 

For the notebook `static/` is the only folder that matters. The folder `dist` is used only to embed widgets outside of the Jupyter notebook environment, which we do not discuss here.

Thus after `npm instal` the following folder are also in :
+ `dist/`: generated by npm
+ `node_modules/`: generated by npm
+ `package-lock.json`: generated by npm

## 2/3 - Install Python package - Put Compiled Javascript in nbextension folder

This is the only regular operation.  
Nothing to outline except that the folder static/ must be installed too.

Do it in 2 steps:
+ `python setup.py sdist`
+ `pip install .`

Practically this operation results in the following folders being created under the path when packages get installed, in my case: `/usr/local/anaconda3/lib/python3.6/site-packages`:
+ `widget_d3_slider-0.1.0a0.dist-info/` contains packaging meta data
+ `widget_d3_slider/` contains the Python source code and the folder static/
And `/usr/local/anaconda3/share/jupyter/nbextensions`:
+ `widget-d3-slider`

The folder `widget_d3_slider/` is just a copy of the source folder containing `.py` files and `static/`
The folder `widget-d3-slider/` is a copy of the `static/` folder

## 4 - Enable nbextension

Now all the files are in place. There is an extra flag to set for the extension to be loaded by the notebook upon start.  
Its location is the `--sys-prefix` jupyter path (type `jupyter --paths`), in my case `/usr/local/anaconda3/etc/jupyter/nbconfig`.
the file name is `notebook.json`. You can change it manually but it is recommended to use command line to enable the extension:
````
jupyter nbextension enable -py --sys-prefix widget_d3_slider
````
Which will have add a line to the file:
````
{
  "load_extensions": {
    "jupyter-js-widgets/extension": true,
    "widget-d3-slider/extension": true
  }
}
````

By the way note that in this command you can substitute use enable/disable and install/uninstall.  
The enable/disable commands will set the flags in this file to true/false.
The enable/disable commands will add/remove the lines in this file.  
In case the actual installation of files in `/usr/local/anaconda3/share/jupyter/nbextensions`, which does happen then the disable/uninstall commands end up in errors, and you must go manual.


DONE !!

In short the commands are
```bash
# compile js
python setup.py sdist
# install package
pip install .
# enable nbextension
jupyter nbextension enable --py --sys-prefix widget_d3_slider
````
_Note_: I still need to find a way to aggregate the first 2 commands.
